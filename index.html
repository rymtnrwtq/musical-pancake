<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>HLS —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    video {
      width: 90%;
      max-width: 800px;
      border: 2px solid #fff;
    }
  </style>
</head>
<body>
  <video id="video" controls></video>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // 1) URL –≤–∞—à–µ–≥–æ Worker‚Äë–ø—Ä–æ–∫—Å–∏
    const proxyBase = 'https://your-worker-name.<username>.workers.dev/?url='

    // 2) –¶–µ–ª–µ–≤–∞—è HLS‚Äë—Å—Å—ã–ª–∫–∞
    const originalUrl = 'https://static.2sub.movie/series/friends/s1e1/hls_sd/1.m3u8'

    // 3) –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π URL
    const videoSrc = proxyBase + encodeURIComponent(originalUrl)
    console.log('üì∫ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫:', videoSrc)

    const video = document.getElementById('video')

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    if (Hls.isSupported()) {
      const hls = new Hls()
      // –õ–æ–≥–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è Hls.js
      hls.on(Hls.Events.ERROR, (event, data) => {
        console.error('HLS.js error:', event, data)
      })
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        console.log('‚úÖ –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, —Å—Ç–∞—Ä—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è')
        video.play().catch(e => console.warn('Play rejected:', e))
      })
      hls.on(Hls.Events.LEVEL_LOADED, (event, data) => {
        console.log(`üåê –£—Ä–æ–≤–µ–Ω—å ${data.level} –∑–∞–≥—Ä—É–∂–µ–Ω, —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: ${data.details.fragments.length}`)
      })
      hls.on(Hls.Events.FRAG_LOADED, (event, data) => {
        console.log(`‚ñ∂Ô∏è –°–µ–≥–º–µ–Ω—Ç ${data.frag.url.split('/').pop()} –∑–∞–≥—Ä—É–∂–µ–Ω (${data.stats.tload}‚ÄØ–º—Å)`)
      })

      console.log('üîó –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ —á–µ—Ä–µ–∑ Hls.js')
      hls.loadSource(videoSrc)
      hls.attachMedia(video)
    }
    else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      console.log('üçé –†–æ–¥–Ω–æ–π HLS –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è')
      video.src = videoSrc
      video.addEventListener('loadedmetadata', () => {
        console.log('‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∑–∞–ø—É—Å–∫–∞–µ–º')
        video.play().catch(e => console.warn('Play rejected:', e))
      })
    }
    else {
      console.error('‚ùå HLS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ')
      alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HLS.')
    }
  </script>
</body>
</html>
